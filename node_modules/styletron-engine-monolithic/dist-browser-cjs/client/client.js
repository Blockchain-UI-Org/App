"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _sheet = require("./sheet");

var _injectStylePrefixed = _interopRequireDefault(require("../inject-style-prefixed"));

var _css = require("../css");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/* eslint-env browser */
class StyletronClient {
  constructor(opts = {}) {
    this.opts = opts || {};
    this.cache = {};

    if (opts.container) {
      this.container = opts.container;
    } // hydration


    if (opts.hydrate && opts.hydrate.length > 1) {
      if (process.env.NODE_ENV !== "production") {
        // eslint-disable-next-line no-console
        console.warn("Client hydration expects only a single style tag from the server. Make sure your server uses styletron-engine-monolithic and not atomic.");
      }
    } else if (opts.hydrate && opts.hydrate.length === 1) {
      // infer container from parent element
      if (!this.container) {
        const parentElement = opts.hydrate[0].parentElement;

        if (parentElement !== null && parentElement !== void 0) {
          this.container = parentElement;
        }
      } // there is a single style tag coming from the monolithic server


      const element = opts.hydrate[0];
      const dataHydrate = element.getAttribute("data-hydrate");

      if (dataHydrate) {
        dataHydrate.split(" ").forEach(hashKey => {
          // cache keys are unique across fonts, keyframes and other css so
          // we use a single attribute to get them all
          this.cache[hashKey] = true;
        });
      }
    }

    if (!this.container) {
      if (document.head === null) {
        throw new Error("No container provided and `document.head` was null");
      }

      this.container = document.head;
    }

    this.styleSheet = new _sheet.StyleSheet({
      container: this.container,
      speedy: this.opts.speedy
    });
  }

  renderStyle(styles) {
    const className = (0, _css.hashCssObject)(styles);

    if (!this.cache[className]) {
      this.cache[className] = true;
      this.styleSheet.insert((0, _injectStylePrefixed.default)(styles, className, this.opts.prefix || "", Boolean(this.opts.strict)));
    }

    return `${this.opts.prefix || ""}css-${className}`;
  }

  renderFontFace(fontFace) {
    const fontName = (0, _css.hashCssObject)(fontFace);

    if (!this.cache[fontName]) {
      this.cache[fontName] = true;
      this.styleSheet.insert([(0, _css.fontFaceBlockToRule)(`${this.opts.prefix || ""}font-${fontName}`, (0, _css.declarationsToBlock)(fontFace))]);
    }

    return `${this.opts.prefix || ""}font-${fontName}`;
  }

  renderKeyframes(keyframes) {
    const animationName = (0, _css.hashCssObject)(keyframes);

    if (!this.cache[animationName]) {
      this.cache[animationName] = true;
      this.styleSheet.insert([(0, _css.keyframesBlockToRule)(`${this.opts.prefix || ""}animation-${animationName}`, (0, _css.keyframesToBlock)(keyframes))]);
    }

    return `${this.opts.prefix || ""}animation-${animationName}`;
  }

}

var _default = StyletronClient;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTdHlsZXRyb25DbGllbnQiLCJjb25zdHJ1Y3RvciIsIm9wdHMiLCJjYWNoZSIsImNvbnRhaW5lciIsImh5ZHJhdGUiLCJsZW5ndGgiLCJjb25zb2xlIiwid2FybiIsInBhcmVudEVsZW1lbnQiLCJlbGVtZW50IiwiZGF0YUh5ZHJhdGUiLCJnZXRBdHRyaWJ1dGUiLCJzcGxpdCIsImZvckVhY2giLCJoYXNoS2V5IiwiZG9jdW1lbnQiLCJoZWFkIiwiRXJyb3IiLCJzdHlsZVNoZWV0IiwiU3R5bGVTaGVldCIsInNwZWVkeSIsInJlbmRlclN0eWxlIiwic3R5bGVzIiwiY2xhc3NOYW1lIiwiaGFzaENzc09iamVjdCIsImluc2VydCIsImluamVjdFN0eWxlUHJlZml4ZWQiLCJwcmVmaXgiLCJCb29sZWFuIiwic3RyaWN0IiwicmVuZGVyRm9udEZhY2UiLCJmb250RmFjZSIsImZvbnROYW1lIiwiZm9udEZhY2VCbG9ja1RvUnVsZSIsImRlY2xhcmF0aW9uc1RvQmxvY2siLCJyZW5kZXJLZXlmcmFtZXMiLCJrZXlmcmFtZXMiLCJhbmltYXRpb25OYW1lIiwia2V5ZnJhbWVzQmxvY2tUb1J1bGUiLCJrZXlmcmFtZXNUb0Jsb2NrIl0sInNvdXJjZXMiOlsic3JjL2NsaWVudC9jbGllbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWVudiBicm93c2VyICovXG5cbmltcG9ydCB7U3R5bGVTaGVldH0gZnJvbSBcIi4vc2hlZXRcIjtcblxuaW1wb3J0IHR5cGUge1xuICBTdGFuZGFyZEVuZ2luZSxcbiAgS2V5ZnJhbWVzT2JqZWN0LFxuICBGb250RmFjZU9iamVjdCxcbiAgU3R5bGVPYmplY3QsXG59IGZyb20gXCJzdHlsZXRyb24tc3RhbmRhcmRcIjtcblxuaW1wb3J0IGluamVjdFN0eWxlUHJlZml4ZWQgZnJvbSBcIi4uL2luamVjdC1zdHlsZS1wcmVmaXhlZFwiO1xuXG5pbXBvcnQge1xuICBrZXlmcmFtZXNCbG9ja1RvUnVsZSxcbiAgZGVjbGFyYXRpb25zVG9CbG9jayxcbiAga2V5ZnJhbWVzVG9CbG9jayxcbiAgZm9udEZhY2VCbG9ja1RvUnVsZSxcbiAgaGFzaENzc09iamVjdCxcbn0gZnJvbSBcIi4uL2Nzc1wiO1xuXG5kZWNsYXJlIHZhciBfX0RFVl9fOiBib29sZWFuO1xudHlwZSBoeWRyYXRlVCA9IEhUTUxDb2xsZWN0aW9uIHwgQXJyYXk8SFRNTFN0eWxlRWxlbWVudD4gfCBOb2RlTGlzdDtcblxudHlwZSBvcHRpb25zVCA9IHtcbiAgaHlkcmF0ZT86IGh5ZHJhdGVUO1xuICBjb250YWluZXI/OiBFbGVtZW50O1xuICBwcmVmaXg/OiBzdHJpbmc7XG4gIHN0cmljdD86IGJvb2xlYW47XG4gIHNwZWVkeT86IGJvb2xlYW47XG59O1xuXG50eXBlIGNhY2hlVCA9IHtcbiAgW2tleTogc3RyaW5nXTogdHJ1ZTtcbn07XG5cbmNsYXNzIFN0eWxldHJvbkNsaWVudCBpbXBsZW1lbnRzIFN0YW5kYXJkRW5naW5lIHtcbiAgY29udGFpbmVyOiBFbGVtZW50O1xuICBvcHRzOiBvcHRpb25zVDtcbiAgc3R5bGVTaGVldDogU3R5bGVTaGVldDtcbiAgY2FjaGU6IGNhY2hlVDtcblxuICBjb25zdHJ1Y3RvcihvcHRzOiBvcHRpb25zVCA9IHt9KSB7XG4gICAgdGhpcy5vcHRzID0gb3B0cyB8fCB7fTtcbiAgICB0aGlzLmNhY2hlID0ge307XG5cbiAgICBpZiAob3B0cy5jb250YWluZXIpIHtcbiAgICAgIHRoaXMuY29udGFpbmVyID0gb3B0cy5jb250YWluZXI7XG4gICAgfVxuXG4gICAgLy8gaHlkcmF0aW9uXG4gICAgaWYgKG9wdHMuaHlkcmF0ZSAmJiBvcHRzLmh5ZHJhdGUubGVuZ3RoID4gMSkge1xuICAgICAgaWYgKF9fREVWX18pIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgIFwiQ2xpZW50IGh5ZHJhdGlvbiBleHBlY3RzIG9ubHkgYSBzaW5nbGUgc3R5bGUgdGFnIGZyb20gdGhlIHNlcnZlci4gTWFrZSBzdXJlIHlvdXIgc2VydmVyIHVzZXMgc3R5bGV0cm9uLWVuZ2luZS1tb25vbGl0aGljIGFuZCBub3QgYXRvbWljLlwiLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAob3B0cy5oeWRyYXRlICYmIG9wdHMuaHlkcmF0ZS5sZW5ndGggPT09IDEpIHtcbiAgICAgIC8vIGluZmVyIGNvbnRhaW5lciBmcm9tIHBhcmVudCBlbGVtZW50XG4gICAgICBpZiAoIXRoaXMuY29udGFpbmVyKSB7XG4gICAgICAgIGNvbnN0IHBhcmVudEVsZW1lbnQgPSBvcHRzLmh5ZHJhdGVbMF0ucGFyZW50RWxlbWVudDtcbiAgICAgICAgaWYgKHBhcmVudEVsZW1lbnQgIT09IG51bGwgJiYgcGFyZW50RWxlbWVudCAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgdGhpcy5jb250YWluZXIgPSBwYXJlbnRFbGVtZW50O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyB0aGVyZSBpcyBhIHNpbmdsZSBzdHlsZSB0YWcgY29taW5nIGZyb20gdGhlIG1vbm9saXRoaWMgc2VydmVyXG4gICAgICBjb25zdCBlbGVtZW50ID0gb3B0cy5oeWRyYXRlWzBdO1xuICAgICAgY29uc3QgZGF0YUh5ZHJhdGUgPSAoZWxlbWVudCBhcyBFbGVtZW50KS5nZXRBdHRyaWJ1dGUoXCJkYXRhLWh5ZHJhdGVcIik7XG4gICAgICBpZiAoZGF0YUh5ZHJhdGUpIHtcbiAgICAgICAgZGF0YUh5ZHJhdGUuc3BsaXQoXCIgXCIpLmZvckVhY2goaGFzaEtleSA9PiB7XG4gICAgICAgICAgLy8gY2FjaGUga2V5cyBhcmUgdW5pcXVlIGFjcm9zcyBmb250cywga2V5ZnJhbWVzIGFuZCBvdGhlciBjc3Mgc29cbiAgICAgICAgICAvLyB3ZSB1c2UgYSBzaW5nbGUgYXR0cmlidXRlIHRvIGdldCB0aGVtIGFsbFxuICAgICAgICAgIHRoaXMuY2FjaGVbaGFzaEtleV0gPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuY29udGFpbmVyKSB7XG4gICAgICBpZiAoZG9jdW1lbnQuaGVhZCA9PT0gbnVsbCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBjb250YWluZXIgcHJvdmlkZWQgYW5kIGBkb2N1bWVudC5oZWFkYCB3YXMgbnVsbFwiKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuaGVhZDtcbiAgICB9XG5cbiAgICB0aGlzLnN0eWxlU2hlZXQgPSBuZXcgU3R5bGVTaGVldCh7XG4gICAgICBjb250YWluZXI6IHRoaXMuY29udGFpbmVyLFxuICAgICAgc3BlZWR5OiB0aGlzLm9wdHMuc3BlZWR5LFxuICAgIH0pO1xuICB9XG5cbiAgcmVuZGVyU3R5bGUoc3R5bGVzOiBTdHlsZU9iamVjdCk6IHN0cmluZyB7XG4gICAgY29uc3QgY2xhc3NOYW1lID0gaGFzaENzc09iamVjdChzdHlsZXMpO1xuICAgIGlmICghdGhpcy5jYWNoZVtjbGFzc05hbWVdKSB7XG4gICAgICB0aGlzLmNhY2hlW2NsYXNzTmFtZV0gPSB0cnVlO1xuICAgICAgdGhpcy5zdHlsZVNoZWV0Lmluc2VydChcbiAgICAgICAgaW5qZWN0U3R5bGVQcmVmaXhlZChcbiAgICAgICAgICBzdHlsZXMsXG4gICAgICAgICAgY2xhc3NOYW1lLFxuICAgICAgICAgIHRoaXMub3B0cy5wcmVmaXggfHwgXCJcIixcbiAgICAgICAgICBCb29sZWFuKHRoaXMub3B0cy5zdHJpY3QpLFxuICAgICAgICApLFxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGAke3RoaXMub3B0cy5wcmVmaXggfHwgXCJcIn1jc3MtJHtjbGFzc05hbWV9YDtcbiAgfVxuXG4gIHJlbmRlckZvbnRGYWNlKGZvbnRGYWNlOiBGb250RmFjZU9iamVjdCk6IHN0cmluZyB7XG4gICAgY29uc3QgZm9udE5hbWUgPSBoYXNoQ3NzT2JqZWN0KGZvbnRGYWNlKTtcbiAgICBpZiAoIXRoaXMuY2FjaGVbZm9udE5hbWVdKSB7XG4gICAgICB0aGlzLmNhY2hlW2ZvbnROYW1lXSA9IHRydWU7XG4gICAgICB0aGlzLnN0eWxlU2hlZXQuaW5zZXJ0KFtcbiAgICAgICAgZm9udEZhY2VCbG9ja1RvUnVsZShcbiAgICAgICAgICBgJHt0aGlzLm9wdHMucHJlZml4IHx8IFwiXCJ9Zm9udC0ke2ZvbnROYW1lfWAsXG4gICAgICAgICAgZGVjbGFyYXRpb25zVG9CbG9jayhmb250RmFjZSksXG4gICAgICAgICksXG4gICAgICBdKTtcbiAgICB9XG4gICAgcmV0dXJuIGAke3RoaXMub3B0cy5wcmVmaXggfHwgXCJcIn1mb250LSR7Zm9udE5hbWV9YDtcbiAgfVxuXG4gIHJlbmRlcktleWZyYW1lcyhrZXlmcmFtZXM6IEtleWZyYW1lc09iamVjdCk6IHN0cmluZyB7XG4gICAgY29uc3QgYW5pbWF0aW9uTmFtZSA9IGhhc2hDc3NPYmplY3Qoa2V5ZnJhbWVzKTtcbiAgICBpZiAoIXRoaXMuY2FjaGVbYW5pbWF0aW9uTmFtZV0pIHtcbiAgICAgIHRoaXMuY2FjaGVbYW5pbWF0aW9uTmFtZV0gPSB0cnVlO1xuICAgICAgdGhpcy5zdHlsZVNoZWV0Lmluc2VydChbXG4gICAgICAgIGtleWZyYW1lc0Jsb2NrVG9SdWxlKFxuICAgICAgICAgIGAke3RoaXMub3B0cy5wcmVmaXggfHwgXCJcIn1hbmltYXRpb24tJHthbmltYXRpb25OYW1lfWAsXG4gICAgICAgICAga2V5ZnJhbWVzVG9CbG9jayhrZXlmcmFtZXMpLFxuICAgICAgICApLFxuICAgICAgXSk7XG4gICAgfVxuICAgIHJldHVybiBgJHt0aGlzLm9wdHMucHJlZml4IHx8IFwiXCJ9YW5pbWF0aW9uLSR7YW5pbWF0aW9uTmFtZX1gO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFN0eWxldHJvbkNsaWVudDtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUVBOztBQVNBOztBQUVBOzs7O0FBYkE7QUFvQ0EsTUFBTUEsZUFBTixDQUFnRDtFQU05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
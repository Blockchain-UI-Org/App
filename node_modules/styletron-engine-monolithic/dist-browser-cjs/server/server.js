"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
exports.generateHtmlString = generateHtmlString;

var _injectStylePrefixed = _interopRequireDefault(require("../inject-style-prefixed"));

var _css = require("../css");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class StyletronServer {
  constructor(opts = {}) {
    this.opts = opts || {};
    this.cache = {};
  }

  renderStyle(styles) {
    const className = (0, _css.hashCssObject)(styles);

    if (!this.cache[className]) {
      this.cache[className] = (0, _injectStylePrefixed.default)(styles, className, this.opts.prefix || "", Boolean(this.opts.strict)).join("");
    }

    return `${this.opts.prefix || ""}css-${className}`;
  }

  renderFontFace(fontFace) {
    const fontName = (0, _css.hashCssObject)(fontFace);

    if (!this.cache[fontName]) {
      this.cache[fontName] = (0, _css.fontFaceBlockToRule)(`${this.opts.prefix || ""}font-${fontName}`, (0, _css.declarationsToBlock)(fontFace));
    }

    return `${this.opts.prefix || ""}font-${fontName}`;
  }

  renderKeyframes(keyframes) {
    const animationName = (0, _css.hashCssObject)(keyframes);

    if (!this.cache[animationName]) {
      this.cache[animationName] = (0, _css.keyframesBlockToRule)(`${this.opts.prefix || ""}animation-${animationName}`, (0, _css.keyframesToBlock)(keyframes));
    }

    return `${this.opts.prefix || ""}animation-${animationName}`;
  }

  getStylesheets() {
    const hashedNames = [...Object.keys(this.cache)];
    return [{
      css: this.getCss(),
      attrs: {
        "data-hydrate": hashedNames.join(" ")
      }
    }];
  }

  getStylesheetsHtml(className = "_styletron_hydrate_") {
    return generateHtmlString(this.getStylesheets(), className);
  }

  getCss() {
    return [...Object.values(this.cache)].join("");
  }

}

function generateHtmlString(sheets, className) {
  let html = "";

  for (let i = 0; i < sheets.length; i++) {
    const sheet = sheets[i];
    const {
      class: originalClassName,
      ...rest
    } = sheet.attrs;
    const attrs = {
      class: originalClassName ? `${className} ${originalClassName}` : className,
      ...rest
    };
    html += `<style${attrsToString(attrs)}>${sheet.css}</style>`;
  }

  return html;
}

function attrsToString(attrs) {
  let result = "";

  for (const attr in attrs) {
    const value = attrs[attr];

    if (value === true) {
      result += " " + attr;
    } else if (value !== false) {
      result += ` ${attr}="${value}"`;
    }
  }

  return result;
}

var _default = StyletronServer;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTdHlsZXRyb25TZXJ2ZXIiLCJjb25zdHJ1Y3RvciIsIm9wdHMiLCJjYWNoZSIsInJlbmRlclN0eWxlIiwic3R5bGVzIiwiY2xhc3NOYW1lIiwiaGFzaENzc09iamVjdCIsImluamVjdFN0eWxlUHJlZml4ZWQiLCJwcmVmaXgiLCJCb29sZWFuIiwic3RyaWN0Iiwiam9pbiIsInJlbmRlckZvbnRGYWNlIiwiZm9udEZhY2UiLCJmb250TmFtZSIsImZvbnRGYWNlQmxvY2tUb1J1bGUiLCJkZWNsYXJhdGlvbnNUb0Jsb2NrIiwicmVuZGVyS2V5ZnJhbWVzIiwia2V5ZnJhbWVzIiwiYW5pbWF0aW9uTmFtZSIsImtleWZyYW1lc0Jsb2NrVG9SdWxlIiwia2V5ZnJhbWVzVG9CbG9jayIsImdldFN0eWxlc2hlZXRzIiwiaGFzaGVkTmFtZXMiLCJPYmplY3QiLCJrZXlzIiwiY3NzIiwiZ2V0Q3NzIiwiYXR0cnMiLCJnZXRTdHlsZXNoZWV0c0h0bWwiLCJnZW5lcmF0ZUh0bWxTdHJpbmciLCJ2YWx1ZXMiLCJzaGVldHMiLCJodG1sIiwiaSIsImxlbmd0aCIsInNoZWV0IiwiY2xhc3MiLCJvcmlnaW5hbENsYXNzTmFtZSIsInJlc3QiLCJhdHRyc1RvU3RyaW5nIiwicmVzdWx0IiwiYXR0ciIsInZhbHVlIl0sInNvdXJjZXMiOlsic3JjL3NlcnZlci9zZXJ2ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUge1N0YW5kYXJkRW5naW5lfSBmcm9tIFwic3R5bGV0cm9uLXN0YW5kYXJkXCI7XG5pbXBvcnQgaW5qZWN0U3R5bGVQcmVmaXhlZCBmcm9tIFwiLi4vaW5qZWN0LXN0eWxlLXByZWZpeGVkXCI7XG5cbmltcG9ydCB0eXBlIHtcbiAgU3R5bGVPYmplY3QsXG4gIEZvbnRGYWNlT2JqZWN0LFxuICBLZXlmcmFtZXNPYmplY3QsXG59IGZyb20gXCJzdHlsZXRyb24tc3RhbmRhcmRcIjtcblxuaW1wb3J0IHtcbiAga2V5ZnJhbWVzVG9CbG9jayxcbiAga2V5ZnJhbWVzQmxvY2tUb1J1bGUsXG4gIGZvbnRGYWNlQmxvY2tUb1J1bGUsXG4gIGRlY2xhcmF0aW9uc1RvQmxvY2ssXG4gIGhhc2hDc3NPYmplY3QsXG59IGZyb20gXCIuLi9jc3NcIjtcblxuZXhwb3J0IHR5cGUgc2hlZXRUID0ge1xuICBjc3M6IHN0cmluZztcbiAgYXR0cnM6IHtcbiAgICBbeDogc3RyaW5nXTogc3RyaW5nO1xuICB9O1xufTtcblxuZXhwb3J0IHR5cGUgb3B0aW9uc1QgPSB7XG4gIHByZWZpeD86IHN0cmluZztcbiAgc3RyaWN0PzogYm9vbGVhbjtcbn07XG5cbmV4cG9ydCB0eXBlIGNhY2hlVCA9IHtcbiAgW2tleTogc3RyaW5nXTogc3RyaW5nO1xufTtcblxuY2xhc3MgU3R5bGV0cm9uU2VydmVyIGltcGxlbWVudHMgU3RhbmRhcmRFbmdpbmUge1xuICBjYWNoZTogY2FjaGVUO1xuICBvcHRzOiBvcHRpb25zVDtcblxuICBjb25zdHJ1Y3RvcihvcHRzOiBvcHRpb25zVCA9IHt9KSB7XG4gICAgdGhpcy5vcHRzID0gb3B0cyB8fCB7fTtcbiAgICB0aGlzLmNhY2hlID0ge307XG4gIH1cblxuICByZW5kZXJTdHlsZShzdHlsZXM6IFN0eWxlT2JqZWN0KTogc3RyaW5nIHtcbiAgICBjb25zdCBjbGFzc05hbWUgPSBoYXNoQ3NzT2JqZWN0KHN0eWxlcyk7XG4gICAgaWYgKCF0aGlzLmNhY2hlW2NsYXNzTmFtZV0pIHtcbiAgICAgIHRoaXMuY2FjaGVbY2xhc3NOYW1lXSA9IGluamVjdFN0eWxlUHJlZml4ZWQoXG4gICAgICAgIHN0eWxlcyxcbiAgICAgICAgY2xhc3NOYW1lLFxuICAgICAgICB0aGlzLm9wdHMucHJlZml4IHx8IFwiXCIsXG4gICAgICAgIEJvb2xlYW4odGhpcy5vcHRzLnN0cmljdCksXG4gICAgICApLmpvaW4oXCJcIik7XG4gICAgfVxuICAgIHJldHVybiBgJHt0aGlzLm9wdHMucHJlZml4IHx8IFwiXCJ9Y3NzLSR7Y2xhc3NOYW1lfWA7XG4gIH1cblxuICByZW5kZXJGb250RmFjZShmb250RmFjZTogRm9udEZhY2VPYmplY3QpOiBzdHJpbmcge1xuICAgIGNvbnN0IGZvbnROYW1lID0gaGFzaENzc09iamVjdChmb250RmFjZSk7XG4gICAgaWYgKCF0aGlzLmNhY2hlW2ZvbnROYW1lXSkge1xuICAgICAgdGhpcy5jYWNoZVtmb250TmFtZV0gPSBmb250RmFjZUJsb2NrVG9SdWxlKFxuICAgICAgICBgJHt0aGlzLm9wdHMucHJlZml4IHx8IFwiXCJ9Zm9udC0ke2ZvbnROYW1lfWAsXG4gICAgICAgIGRlY2xhcmF0aW9uc1RvQmxvY2soZm9udEZhY2UpLFxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGAke3RoaXMub3B0cy5wcmVmaXggfHwgXCJcIn1mb250LSR7Zm9udE5hbWV9YDtcbiAgfVxuXG4gIHJlbmRlcktleWZyYW1lcyhrZXlmcmFtZXM6IEtleWZyYW1lc09iamVjdCk6IHN0cmluZyB7XG4gICAgY29uc3QgYW5pbWF0aW9uTmFtZSA9IGhhc2hDc3NPYmplY3Qoa2V5ZnJhbWVzKTtcbiAgICBpZiAoIXRoaXMuY2FjaGVbYW5pbWF0aW9uTmFtZV0pIHtcbiAgICAgIHRoaXMuY2FjaGVbYW5pbWF0aW9uTmFtZV0gPSBrZXlmcmFtZXNCbG9ja1RvUnVsZShcbiAgICAgICAgYCR7dGhpcy5vcHRzLnByZWZpeCB8fCBcIlwifWFuaW1hdGlvbi0ke2FuaW1hdGlvbk5hbWV9YCxcbiAgICAgICAga2V5ZnJhbWVzVG9CbG9jayhrZXlmcmFtZXMpLFxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGAke3RoaXMub3B0cy5wcmVmaXggfHwgXCJcIn1hbmltYXRpb24tJHthbmltYXRpb25OYW1lfWA7XG4gIH1cblxuICBnZXRTdHlsZXNoZWV0cygpOiBBcnJheTxzaGVldFQ+IHtcbiAgICBjb25zdCBoYXNoZWROYW1lcyA9IFsuLi5PYmplY3Qua2V5cyh0aGlzLmNhY2hlKV07XG4gICAgcmV0dXJuIFtcbiAgICAgIHtcbiAgICAgICAgY3NzOiB0aGlzLmdldENzcygpLFxuICAgICAgICBhdHRyczoge1wiZGF0YS1oeWRyYXRlXCI6IGhhc2hlZE5hbWVzLmpvaW4oXCIgXCIpfSxcbiAgICAgIH0sXG4gICAgXTtcbiAgfVxuXG4gIGdldFN0eWxlc2hlZXRzSHRtbChjbGFzc05hbWU6IHN0cmluZyA9IFwiX3N0eWxldHJvbl9oeWRyYXRlX1wiKSB7XG4gICAgcmV0dXJuIGdlbmVyYXRlSHRtbFN0cmluZyh0aGlzLmdldFN0eWxlc2hlZXRzKCksIGNsYXNzTmFtZSk7XG4gIH1cblxuICBnZXRDc3MoKSB7XG4gICAgcmV0dXJuIFsuLi5PYmplY3QudmFsdWVzKHRoaXMuY2FjaGUpXS5qb2luKFwiXCIpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUh0bWxTdHJpbmcoc2hlZXRzOiBBcnJheTxzaGVldFQ+LCBjbGFzc05hbWU6IHN0cmluZykge1xuICBsZXQgaHRtbCA9IFwiXCI7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc2hlZXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3Qgc2hlZXQgPSBzaGVldHNbaV07XG4gICAgY29uc3Qge2NsYXNzOiBvcmlnaW5hbENsYXNzTmFtZSwgLi4ucmVzdH0gPSBzaGVldC5hdHRycztcbiAgICBjb25zdCBhdHRycyA9IHtcbiAgICAgIGNsYXNzOiBvcmlnaW5hbENsYXNzTmFtZVxuICAgICAgICA/IGAke2NsYXNzTmFtZX0gJHtvcmlnaW5hbENsYXNzTmFtZX1gXG4gICAgICAgIDogY2xhc3NOYW1lLFxuICAgICAgLi4ucmVzdCxcbiAgICB9O1xuICAgIGh0bWwgKz0gYDxzdHlsZSR7YXR0cnNUb1N0cmluZyhhdHRycyl9PiR7c2hlZXQuY3NzfTwvc3R5bGU+YDtcbiAgfVxuICByZXR1cm4gaHRtbDtcbn1cblxuZnVuY3Rpb24gYXR0cnNUb1N0cmluZyhhdHRycykge1xuICBsZXQgcmVzdWx0ID0gXCJcIjtcbiAgZm9yIChjb25zdCBhdHRyIGluIGF0dHJzKSB7XG4gICAgY29uc3QgdmFsdWUgPSBhdHRyc1thdHRyXTtcbiAgICBpZiAodmFsdWUgPT09IHRydWUpIHtcbiAgICAgIHJlc3VsdCArPSBcIiBcIiArIGF0dHI7XG4gICAgfSBlbHNlIGlmICh2YWx1ZSAhPT0gZmFsc2UpIHtcbiAgICAgIHJlc3VsdCArPSBgICR7YXR0cn09XCIke3ZhbHVlfVwiYDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgU3R5bGV0cm9uU2VydmVyO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUNBOztBQVFBOzs7O0FBd0JBLE1BQU1BLGVBQU4sQ0FBZ0Q7RUFJOUNDLFdBQVcsQ0FBQ0MsSUFBYyxHQUFHLEVBQWxCLEVBQXNCO0lBQy9CLEtBQUtBLElBQUwsR0FBWUEsSUFBSSxJQUFJLEVBQXBCO0lBQ0EsS0FBS0MsS0FBTCxHQUFhLEVBQWI7RUFDRDs7RUFFREMsV0FBVyxDQUFDQyxNQUFELEVBQThCO0lBQ3ZDLE1BQU1DLFNBQVMsR0FBRyxJQUFBQyxrQkFBQSxFQUFjRixNQUFkLENBQWxCOztJQUNBLElBQUksQ0FBQyxLQUFLRixLQUFMLENBQVdHLFNBQVgsQ0FBTCxFQUE0QjtNQUMxQixLQUFLSCxLQUFMLENBQVdHLFNBQVgsSUFBd0IsSUFBQUUsNEJBQUEsRUFDdEJILE1BRHNCLEVBRXRCQyxTQUZzQixFQUd0QixLQUFLSixJQUFMLENBQVVPLE1BQVYsSUFBb0IsRUFIRSxFQUl0QkMsT0FBTyxDQUFDLEtBQUtSLElBQUwsQ0FBVVMsTUFBWCxDQUplLEVBS3RCQyxJQUxzQixDQUtqQixFQUxpQixDQUF4QjtJQU1EOztJQUNELE9BQVEsR0FBRSxLQUFLVixJQUFMLENBQVVPLE1BQVYsSUFBb0IsRUFBRyxPQUFNSCxTQUFVLEVBQWpEO0VBQ0Q7O0VBRURPLGNBQWMsQ0FBQ0MsUUFBRCxFQUFtQztJQUMvQyxNQUFNQyxRQUFRLEdBQUcsSUFBQVIsa0JBQUEsRUFBY08sUUFBZCxDQUFqQjs7SUFDQSxJQUFJLENBQUMsS0FBS1gsS0FBTCxDQUFXWSxRQUFYLENBQUwsRUFBMkI7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